{"version":3,"sources":["../src/student_copy_controls.js"],"names":["getStudentsDetails","Log","debug","students","children","each","studentId","attr","studentEmail","studentName","push","createStudentFileCopyService","distribution","Ajax","call","methodname","args","JSON","stringify","instanceid","done","response","records","parse","renderingHandler","fail","reason","error","renderShareSameGroup","renderCopyResults","renderCopyGroup","renderShareSameGrouping","renderGroupGroupingCopy","i","tablerows","document","querySelectorAll","getAttribute","record","find","userid","querySelector","href","url","classList","remove","innerText","length","reduce","a","b","concat","hasAttribute","groupId","groupid","groupingId","groupingid","gId","gType","init"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Provides the mod_googleactivity/student_copy_controls module\n *\n * Contains the functionality for distribution types student gets own copy (std_copy)\n * and students share same copy (dist_share_same)\n *\n * @package   mod_googleactivity\n * @category  output\n * @copyright 2021 Veronica Bermegui\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n/**\n * @module mod_googleactivity/student_copy_controls\n *\n */\n\nimport $ from \"jquery\";\nimport * as Log from \"core/log\";\nimport Ajax from \"core/ajax\";\n\nconst getStudentsDetails = () => {\n  Log.debug(\"Collecting students details ...\");\n  let students = [];\n\n  $(\"tbody\")\n    .children()\n    .each(function () {\n      const studentId = $(this).attr(\"data-student-id\");\n      const studentEmail = $(this).attr(\"data-student-email\");\n      const studentName = $(this).attr(\"student-name\");\n      // Only add elements with values. undefined return false.\n      if (studentId && studentEmail && studentName) {\n        students.push({\n          studentId: studentId,\n          studentEmail: studentEmail,\n          studentName: studentName,\n        });\n      }\n    });\n\n  return students;\n};\n\nconst createStudentFileCopyService = (distribution) => {\n  Log.debug(\"In createStudentFileCopyService...\");\n\n  Ajax.call([\n    {\n      methodname: \"mod_googleactivity_create_students_files\",\n      args: {\n        students: JSON.stringify(getStudentsDetails()),\n        instanceid: $(\"table.overviewTable\").attr(\"data-instance-id\"),\n      },\n      done: function (response) {\n        var records = JSON.parse(response.records);\n        renderingHandler(records, distribution);\n      },\n      fail: function (reason) {\n        Log.error(reason);\n      },\n    },\n  ]);\n};\n\nconst renderingHandler = (records, distribution) => {\n  if (distribution == \"group_copy\" || distribution == \"dist_share_same_group\") {\n    renderShareSameGroup(records, distribution);\n  }\n\n  if (distribution == \"std_copy\" || distribution == \"dist_share_same\") {\n    renderCopyResults(records);\n  }\n\n  if (\n    distribution == \"std_copy_group\" ||\n    distribution == \"std_copy_grouping\" ||\n    distribution == \"std_copy_group_grouping\"\n  ) {\n    renderCopyGroup(records);\n  }\n\n  if (distribution == \"dist_share_same_grouping\") {\n    renderShareSameGrouping(records);\n  }\n\n  if (\n    distribution == \"group_grouping_copy\" ||\n    distribution == \"dist_share_same_group_grouping\"\n  ) {\n    renderGroupGroupingCopy(records);\n  }\n};\n\n/**\n *\n * @param {*} records\n */\nconst renderCopyResults = (records) => {\n  Log.debug(\"Rendering results ...\");\n  let i;\n  const tablerows = document.querySelectorAll(\"#table-body tr\");\n\n  for (i = 0; i < tablerows.length; i++) {\n    let studentId = tablerows[i].getAttribute(\"data-student-id\");\n    let record = records.find((record) => record.userid == studentId);\n\n    tablerows[i].querySelector(\"#link_file_\" + i).href = record.url;\n    tablerows[i].querySelector(\"#file_\" + i).classList.remove(\"spinner-border\");\n    tablerows[i].querySelector(\"#file_\" + i).innerText = \"Created\";\n  }\n};\n\nconst renderCopyGroup = (records) => {\n  Log.debug(\"In renderCopyGroup...\");\n  // Combine the results.\n  records = records.reduce(function (a, b) {\n    return a.concat(b);\n  }, []);\n\n  let i;\n  const tablerows = document.querySelectorAll(\"#table-body tr\");\n  for (i = 0; i < tablerows.length; i++) {\n    let studentId = tablerows[i].getAttribute(\"data-student-id\");\n    let record = records.find((record) => record.userid == studentId);\n\n    tablerows[i].querySelector(\"#link_file_\" + i).href = record.url;\n    tablerows[i].querySelector(\"#file_\" + i).classList.remove(\"spinner-border\");\n    tablerows[i].querySelector(\"#file_\" + i).innerText = \"Created\";\n  }\n};\n\nconst renderShareSameGroup = (records) => {\n  Log.debug(\"In renderShareSameGroup...\");\n  // Combine the results.\n  records = records.reduce(function (a, b) {\n    return a.concat(b);\n  }, []);\n\n  let i;\n  const tablerows = document.querySelectorAll(\"#table-body tr\");\n\n  for (i = 0; i < tablerows.length; i++) {\n    if (tablerows[i].hasAttribute(\"id\")) {\n      let groupId = tablerows[i].getAttribute(\"data-group-id\");\n      let record = records.find((record) => record.groupid == groupId);\n\n      tablerows[i].querySelector(\"#shared_link_url_\" + record.groupid).href =\n        record.url;\n      tablerows[i]\n        .querySelector(\"#status_col\")\n        .classList.remove(\"spinner-border\");\n      tablerows[i].querySelector(\"#status_col\").innerText = \"Created\";\n    }\n  }\n};\n\nconst renderShareSameGrouping = (records) => {\n  Log.debug(\"In renderShareSameGrouping...\");\n  // Combine the results.\n  records = records.reduce(function (a, b) {\n    return a.concat(b);\n  }, []);\n  Log.debug(records);\n  let i;\n  const tablerows = document.querySelectorAll(\"#table-body tr\");\n\n  for (i = 0; i < tablerows.length; i++) {\n    if (tablerows[i].hasAttribute(\"id\")) {\n      let groupingId = tablerows[i].getAttribute(\"data-grouping-id\");\n      let record = records.find((record) => record.groupingid == groupingId);\n\n      tablerows[i].querySelector(\"#shared_link_url_\" + record.groupingid).href =\n        record.url;\n      tablerows[i]\n        .querySelector(\"#status_col_\" + groupingId)\n        .classList.remove(\"spinner-border\");\n      tablerows[i].querySelector(\"#status_col_\" + groupingId).innerText =\n        \"Created\";\n    }\n  }\n};\n\nconst renderGroupGroupingCopy = (records) => {\n  Log.debug(\"In renderGroupGroupingCopy...\");\n  // Combine the results.\n  records = records.reduce(function (a, b) {\n    return a.concat(b);\n  }, []);\n  Log.debug(records);\n  let i;\n  const tablerows = document.querySelectorAll(\"#table-body tr\");\n  for (i = 0; i < tablerows.length; i++) {\n    if (tablerows[i].hasAttribute(\"id\")) {\n      let gId = tablerows[i].getAttribute(\"data-g-id\");\n      let gType = tablerows[i].getAttribute(\"data-g-type\");\n      let record;\n      if (gType == \"grouping\") {\n        record = records.find((record) => record.groupingid == gId);\n\n        tablerows[i].querySelector(\n          \"#shared_link_url_\" + record.groupingid\n        ).href = record.url;\n      } else {\n        record = records.find((record) => record.groupid == gId);\n\n        tablerows[i].querySelector(\"#shared_link_url_\" + record.groupid).href =\n          record.url;\n      }\n\n      tablerows[i]\n        .querySelector(\"#status_col_\" + gId)\n        .classList.remove(\"spinner-border\");\n      tablerows[i].querySelector(\"#status_col_\" + gId).innerText = \"Created\";\n    }\n  }\n};\n\nexport const init = (distribution) => {\n  createStudentFileCopyService(distribution);\n};\n"],"file":"student_copy_controls.min.js"}