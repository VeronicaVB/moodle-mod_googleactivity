{"version":3,"sources":["../src/student_copy_controls.js"],"names":["getStudentsDetails","Log","debug","students","children","each","studentId","attr","studentEmail","studentName","push","createStudentFileCopyService","distribution","Ajax","call","methodname","args","JSON","stringify","instanceid","done","response","records","parse","renderCopyResults","renderCopyGroup","renderShareSameGroup","fail","reason","error","i","tablerows","document","querySelectorAll","getAttribute","record","find","userid","querySelector","href","url","classList","remove","innerText","length","reduce","a","b","concat","hasAttribute","groupId","groupid","init"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Provides the mod_googleactivity/student_copy_controls module\n *\n * Contains the functionality for distribution types student gets own copy (std_copy)\n * and students share same copy (dist_share_same)\n *\n * @package   mod_googleactivity\n * @category  output\n * @copyright 2021 Veronica Bermegui\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n/**\n * @module mod_googleactivity/student_copy_controls\n *\n */\n\nimport $ from \"jquery\";\nimport * as Log from \"core/log\";\nimport Ajax from \"core/ajax\";\n\nconst getStudentsDetails = () => {\n  Log.debug(\"Collecting students details ...\");\n  let students = [];\n\n  $(\"tbody\")\n    .children()\n    .each(function () {\n      const studentId = $(this).attr(\"data-student-id\");\n      const studentEmail = $(this).attr(\"data-student-email\");\n      const studentName = $(this).attr(\"student-name\");\n      // Only add elements with values. undefined return false.\n      if (studentId && studentEmail && studentName) {\n        students.push({\n          studentId: studentId,\n          studentEmail: studentEmail,\n          studentName: studentName,\n        });\n      }\n    });\n\n  return students;\n};\n\nconst createStudentFileCopyService = (distribution) => {\n  Log.debug(\"In createStudentFileCopyService...\");\n\n  Ajax.call([\n    {\n      methodname: \"mod_googleactivity_create_students_files\",\n      args: {\n        students: JSON.stringify(getStudentsDetails()),\n        instanceid: $(\"table.overviewTable\").attr(\"data-instance-id\"),\n      },\n      done: function (response) {\n        var records = JSON.parse(response.records);\n\n        switch (distribution) {\n          case \"std_copy\":\n            renderCopyResults(records);\n            break;\n          case \"dist_share_same\":\n            renderCopyResults(records);\n          break;\n          case \"std_copy_group\":\n            renderCopyGroup(records);\n            break;\n          case \"dist_share_same_group\":\n            renderShareSameGroup(records);\n            break;\n          default:\n            break;\n        }\n      },\n      fail: function (reason) {\n        Log.error(reason);\n      },\n    },\n  ]);\n};\n\n/**\n * \n * @param {*} records \n */\nconst renderCopyResults = (records) => {\n  let i;\n  const tablerows = document.querySelectorAll(\"#table-body tr\");\n\n  for (i = 0; i < tablerows.length; i++) {\n    let studentId = tablerows[i].getAttribute(\"data-student-id\");\n    let record = records.find((record) => record.userid == studentId);\n\n    tablerows[i].querySelector(\"#link_file_\" + i).href = record.url;\n    tablerows[i].querySelector(\"#file_\" + i).classList.remove(\"spinner-border\");\n    tablerows[i].querySelector(\"#file_\" + i).innerText = \"Created\";\n  }\n};\n\nconst renderCopyGroup = (records) => {\n  Log.debug(\"In renderStdCopyGroup...\");\n  // Combine the results.\n  records = records.reduce(function (a, b) {\n    return a.concat(b);\n  }, []);\n\n  let i;\n  const tablerows = document.querySelectorAll(\"#table-body tr\");\n  for (i = 0; i < tablerows.length; i++) {\n    let studentId = tablerows[i].getAttribute(\"data-student-id\");\n    let record = records.find((record) => record.userid == studentId);\n\n    tablerows[i].querySelector(\"#link_file_\" + i).href = record.url;\n    tablerows[i].querySelector(\"#file_\" + i).classList.remove(\"spinner-border\");\n    tablerows[i].querySelector(\"#file_\" + i).innerText = \"Created\";\n  }\n};\n\nconst renderShareSameGroup = (records) => {\n  Log.debug(\"In renderShareSameGroup...\");\n  // Combine the results.\n  records = records.reduce(function (a, b) {\n    return a.concat(b);\n  }, []);\n\n  let i;\n  const tablerows = document.querySelectorAll(\"#table-body tr\");\n  for (i = 0; i < tablerows.length; i++) {\n    Log.debug(tablerows[i]);\n    if (tablerows[i].hasAttribute(\"id\")) {\n      let groupId = tablerows[i].getAttribute(\"data-group-id\");\n      let record = records.find((record) => record.groupid == groupId);\n\n      tablerows[i].querySelector(\"#shared_link_url_\" + record.groupid).href =\n        record.url;\n      tablerows[i]\n        .querySelector(\"#status_col\")\n        .classList.remove(\"spinner-border\");\n      tablerows[i].querySelector(\"#status_col\").innerText = \"Created\";\n    }\n  }\n};\n\nexport const init = (distribution) => {\n  createStudentFileCopyService(distribution);\n};\n"],"file":"student_copy_controls.min.js"}