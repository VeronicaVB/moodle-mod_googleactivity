function _typeof(a){"@babel/helpers - typeof";if("function"==typeof Symbol&&"symbol"==typeof Symbol.iterator){_typeof=function(a){return typeof a}}else{_typeof=function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a}}return _typeof(a)}define ("mod_googleactivity/student_copy_controls",["exports","jquery","core/log","core/ajax"],function(a,b,c,d){"use strict";Object.defineProperty(a,"__esModule",{value:!0});a.init=void 0;b=g(b);c=f(c);d=g(d);function e(){if("function"!=typeof WeakMap)return null;var a=new WeakMap;e=function(){return a};return a}function f(a){if(a&&a.__esModule){return a}if(null===a||"object"!==_typeof(a)&&"function"!=typeof a){return{default:a}}var b=e();if(b&&b.has(a)){return b.get(a)}var c={},d=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var f in a){if(Object.prototype.hasOwnProperty.call(a,f)){var g=d?Object.getOwnPropertyDescriptor(a,f):null;if(g&&(g.get||g.set)){Object.defineProperty(c,f,g)}else{c[f]=a[f]}}}c.default=a;if(b){b.set(a,c)}return c}function g(a){return a&&a.__esModule?a:{default:a}}var h=function(){c.debug("Collecting students details ...");var a=[];(0,b.default)("tbody").children().each(function(){var c=(0,b.default)(this).attr("data-student-id"),d=(0,b.default)(this).attr("data-student-email"),e=(0,b.default)(this).attr("student-name");if(c&&d&&e){a.push({studentId:c,studentEmail:d,studentName:e})}});return a},i=function(a){c.debug("In createStudentFileCopyService...");d.default.call([{methodname:"mod_googleactivity_create_students_files",args:{students:JSON.stringify(h()),instanceid:(0,b.default)("table.overviewTable").attr("data-instance-id")},done:function done(b){var d=JSON.parse(b.records);d=d.reduce(function(c,a){return c.concat(a)},[]);var e=JSON.parse(b.status);e=e.reduce(function(c,a){return c.concat(a)},[]);c.debug(e);j(d,a,e)},fail:function fail(a){c.error(a)}}])},j=function(a,b,c){if("group_copy"==b||"dist_share_same_group"==b){m(a,b,c)}if("std_copy"==b||"dist_share_same"==b){k(a,c)}if("std_copy_group"==b||"std_copy_grouping"==b||"std_copy_group_grouping"==b){l(a,c)}if("dist_share_same_grouping"==b){n(a,c)}if("group_grouping_copy"==b||"dist_share_same_group_grouping"==b){o(a,c)}},k=function(a,b){c.debug("Rendering results ...");var d,e=document.querySelectorAll("#table-body tr"),f=function(){var f=e[d].getAttribute("data-student-id"),g=a.find(function(a){return a.userid==f}),h=b.find(function(a){return a.userid==f}),i="";if(!g){i="Failed";c.debug("StudentId:  "+f+"Creation status: "+h.creation_status)}else{e[d].querySelector("#link_file_"+d).href=g.url;i="Created"}e[d].querySelector("#file_"+d).classList.remove("spinner-border");e[d].querySelector("#file_"+d).innerText=i};for(d=0;d<e.length;d++){f()}},l=function(a,b){c.debug("In renderCopyGroup...");c.debug(b);var d,e=document.querySelectorAll("#table-body tr"),f=function(){var f=e[d].getAttribute("data-student-id"),g=a.find(function(a){return a.userid==f}),h=b.find(function(a){return a.userid==f}),i="";if(!g){i="Failed";c.debug("StudentId:  "+f+"Creation status: "+h.creation_status)}else{e[d].querySelector("#link_file_"+d).href=g.url;i="Created"}e[d].querySelector("#file_"+d).classList.remove("spinner-border");e[d].querySelector("#file_"+d).innerText=i};for(d=0;d<e.length;d++){f()}},m=function(a){c.debug("In renderShareSameGroup...");var b,d=document.querySelectorAll("#table-body tr");for(b=0;b<d.length;b++){if(d[b].hasAttribute("id")){(function(){var c=d[b].getAttribute("data-group-id"),e=a.find(function(a){return a.groupid==c});d[b].querySelector("#shared_link_url_"+e.groupid).href=e.url;d[b].querySelector("#status_col").classList.remove("spinner-border");d[b].querySelector("#status_col").innerText="Created"})()}}},n=function(a,b){c.debug("In renderShareSameGrouping...");c.debug(a);c.debug(b);var d,e=document.querySelectorAll("#table-body tr");for(d=0;d<e.length;d++){if(e[d].hasAttribute("id")){(function(){var f=e[d].getAttribute("data-grouping-id"),g=a.find(function(a){return a.groupingid==f}),h=b.find(function(a){return"OK"!=a.creation_status}),i="";if(h){p()}if(!g){i="Failed";c.debug("groupingId:  "+f+"Creation status: "+h)}else{i="Created";e[d].querySelector("#shared_link_url_"+g.groupingid).href=g.url}e[d].querySelector("#status_col_"+f).classList.remove("spinner-border");e[d].querySelector("#status_col_"+f).innerText=i})()}}},o=function(a,b){c.debug("In renderGroupGroupingCopy...");c.debug(a);var d,e=document.querySelectorAll("#table-body tr");for(d=0;d<e.length;d++){if(e[d].hasAttribute("id")){(function(){var c=e[d].getAttribute("data-g-id"),f=e[d].getAttribute("data-g-type"),g=void 0,h=b.find(function(a){return"OK"!=a.creation_status}),i="";if(h){p()}if("grouping"==f){g=a.find(function(a){return a.groupingid==c});if(!g){i="Failed"}else{e[d].querySelector("#shared_link_url_"+g.groupingid).href=g.url}}else{g=a.find(function(a){return a.groupid==c});if(!a){i="Failed"}e[d].querySelector("#shared_link_url_"+g.groupid).href=g.url}e[d].querySelector("#status_col_"+c).classList.remove("spinner-border");e[d].querySelector("#status_col_"+c).innerText=i})()}}},p=function(){var a=document.createElement("div"),b=document.querySelector("table.mod-googleactivity-files-view");a.classList.add("alert");a.classList.add("alert-warning");var c=document.createTextNode("There were some errors in the process...");a.appendChild(c);b.insertAdjacentElement("afterEnd",a)};a.init=function init(a){i(a)}});
//# sourceMappingURL=student_copy_controls.min.js.map
